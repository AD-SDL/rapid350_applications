name: Demo - Workflow

metadata:
  author: Casey Stone, Abraham Stroka
  info: Demonstration Workflow for BIO350 Workcell
  version: 0.1

# modules:
#   - name: solo_sam
#   - name: platecrane_poly
#   - name: hidex_howard
#   - name: sealer_harp
#   - name: peeler_potato
#   - name: liconic_lisa

parameters:
  - name: tip_box_position
  - name: protocol_file
  - name: shaker_speed
  - name: seal_time

steps:
  - name: Move plate from Stack1 to Solo.Position2  # WORKS
    node: platecrane_poly
    action: transfer
    args:
      plate_type: "flat_bottom_96well"
    locations:
      source: "Stack1"
      target: "Solo.Position2"
      # source:   # example of using custom locations not defined in the workcell
      #   location:
      #     name: "Stack1"
      #     location_type: "stack"
      #     joint_angles: [164713, -32703, 450, 5472]
      #     safe_approach_height: 0
      # target:
      #   location:
      #     name: "Solo.Position2"
      #     joint_angles: [57372, -27457, -233, 2613]
      #     location_type: "nest"
      #     safe_approach_height: 0
    comment: Place plate in Solo Position2

  - name: Remove lid     # WORKS
    node: platecrane_poly
    action: remove_lid
    args:
      plate_type: "flat_bottom_96well"
    locations:
      source: "Solo.Position2"
      target: "LidNest1"
    comment: Place plate lid on lid nest 2

  - name: Move platecrane to Safe location   # WORKS
    node: platecrane_poly
    action: move
    locations:
      target: "Safe"
    comment: Move platecrane out of the way of SOLO arm

  - name: Refill Tips
    node: solo_sam
    action: refill_tips
    args:
      position: $tip_box_position
    comment: Reset Tip Box Number to 96 Tips

   # STEP 1
  - name: Mix Reactions
    node: solo_sam
    action: run_protocol
    files:
      protocol_file: $protocol_file
    comment: resource check not implemented, but will be

  - name: Open Hidex  # WORKS
    node: hidex_howard
    action: open
    comment: Open Hidex Gate

  - name: Move plate from Solo Position2 to Hidex Nest
    node: platecrane_poly
    action: transfer
    args:
      plate_type: "flat_bottom_96well"
      height_offset: 8
    locations:
      source: "Solo.Position2"
      target: "Hidex.Nest"
    comment: Place plate to Hidex Nest

  - name: Close Hidex   # WORKS
    node: hidex_howard
    action: close
    comment: Close Hidex Gate

  - name: Open Hidex    # WORKS
    node: hidex_howard
    action: open
    comment: Open Hidex Gate

  - name: Move plate from Hidex.Nest to Sealer  # WORKS
    node: platecrane_poly
    action: transfer
    args:
      plate_type: "flat_bottom_96well"
      height_offset: 8
    locations:
      source: "Hidex.Nest"
      target: "Sealer.Nest"
    comment: Place plate to Sealer

  - name: Close Hidex   # WORKS
    node: hidex_howard
    action: close
    comment: Close Hidex Gate

  - name: Seal plate  # WORKS
    node: sealer_harp
    action: seal
    comment: Seal the plate

  - name: Move plate from Sealer to Liconic   # WORKED - Why with air off?
    node: platecrane_poly
    action: transfer
    args:
      plate_type: "flat_bottom_96well"
    locations:
      source: "Sealer.Nest"
      target: "Liconic.Nest"
    comment: Place plate onto Liconic

  - name: Load Liconic   # WORKS
    node: liconic_lisa
    action: load_plate
    args:
      plate_id: "1"
    comment: Load assay plate into Liconic

  - name: Start shaker at set speed   # WORKS
    node: liconic_lisa
    action: begin_shake
    args:
      shaker_speed: $shaker_speed
    comment: Stage pcr plates

  - name: Unload Liconic    # WORKS
    node: liconic_lisa
    action: unload_plate
    args:
      plate_id: "1"
    comment: Stage pcr plates

  - name: Move plate from Liconic to Peeler   # WORKS
    node: platecrane_poly
    action: transfer
    args:
      plate_type: "flat_bottom_96well"
    locations:
      source: "Liconic.Nest"
      target: "Peeler.Nest"
    comment: Place plate onto PeelerNest

  - name: Peel  # WORKS
    node: peeler_potato
    action: peel
    comment: null

  - name: Open Hidex    # WORKS
    node: hidex_howard
    action: open
    comment: Open Hidex Gate

  - name: Move plate from Peeler.Nest to Hidex.Nest  # WORKS
    node: platecrane_poly
    action: transfer
    args:
      plate_type: "flat_bottom_96well"
      height_offset: 8
    locations:
      source: "Peeler.Nest"
      target: "Hidex.Nest"
    comment: Place plate in Hidex Nest

  - name: Close Hidex   # WORKS
    node: hidex_howard
    action: close
    comment: Close Hidex Gate

  - name: Open Hidex    # WORKS
    node: hidex_howard
    action: open
    comment: Open Hidex Gate

  - name: Move plate from HidexNest to Stack1  # WORKS
    node: platecrane_poly
    action: transfer
    args:
      plate_type: "flat_bottom_96well"
      height_offset: 8
    locations:
      source: "Hidex.Nest"
      target: "Stack5"
    comment: Place plate into trash Stack

  - name: Close Hidex   # WORKS
    node: hidex_howard
    action: close
    comment: Close Hidex Gate


